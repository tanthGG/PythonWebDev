{% extends 'myapp/base.html' %}
{% load static %}

{% block content %}
<script src="https://cdn.tailwindcss.com"></script>
<section class="bg-gradient-to-br from-white via-[#F9F7C9] to-[#D5F0C1]">
  <div class="mx-auto max-w-6xl px-4 py-14 sm:px-6 lg:px-8">
    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
      <div>
        <p class="text-sm font-semibold uppercase tracking-wide text-[#35605A]">Fleet planner</p>
        <h1 class="text-3xl font-bold text-[#173737]">ATV assignment board</h1>
        <p class="mt-2 text-sm text-[#3B4F4F]">Staff-only page to mark which of the 50 bikes are scheduled for a specific day and track past usage.</p>
      </div>
      <div class="rounded-2xl bg-white/70 px-5 py-3 text-sm text-[#173737] shadow">
        <p class="font-semibold">Managing date</p>
        <p>{{ manage_date|date:"l, d M Y" }}</p>
      </div>
    </div>

    <form method="post" class="mt-8 rounded-3xl border border-[#AAD9BB] bg-white p-6 shadow-xl shadow-[#AAD9BB]/30">
      {% csrf_token %}
      <input type="hidden" name="form" value="assign">
      <div class="flex flex-col gap-4 sm:flex-row sm:items-end sm:justify-between">
        <label class="flex flex-col text-sm font-semibold text-[#173737]">
          Assign for date
          <input type="date" name="assign_date" value="{{ manage_date|date:'Y-m-d' }}" class="mt-1 rounded-xl border border-[#D5F0C1] px-3 py-2 focus:border-[#80BCBD] focus:outline-none focus:ring-2 focus:ring-[#80BCBD]" required>
        </label>
        <button type="submit" class="inline-flex items-center justify-center rounded-full bg-[#80BCBD] px-6 py-3 text-sm font-semibold text-white shadow-lg shadow-[#80BCBD]/40 transition hover:bg-[#6AA4A5]">Save selection</button>
      </div>
      <p class="mt-4 text-sm text-[#3B4F4F]">Tick each ATV that will be active on the selected day.</p>
      <div class="mt-6 grid gap-3 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5">
        {% for bike in bikes %}
        <label class="flex items-center gap-3 rounded-2xl border border-[#D5F0C1] bg-[#F9F7C9]/60 px-4 py-3 text-sm font-medium text-[#173737] shadow-sm">
          <input type="checkbox" name="bikes" value="{{ bike.id }}" class="h-4 w-4 rounded border-[#80BCBD] text-[#80BCBD] focus:ring-[#80BCBD]" {% if bike.id in selected_ids %}checked{% endif %}>
          ATV #{{ bike.number }}{% if bike.nickname %}<span class="text-xs text-[#4a6666]">({{ bike.nickname }})</span>{% endif %}
        </label>
        {% endfor %}
      </div>
      <p class="mt-4 text-xs text-[#7a7a7a]">Any bikes left unticked will be treated as idle for this date.</p>
    </form>

    <div class="mt-10 rounded-3xl border border-[#AAD9BB] bg-white p-6 shadow">
      <h2 class="text-xl font-bold text-[#173737]">Currently assigned bikes</h2>
      {% if assignments_for_date %}
      <div class="mt-4 flex flex-wrap gap-3">
        {% for assignment in assignments_for_date %}
        <span class="inline-flex items-center rounded-full bg-[#D5F0C1] px-4 py-1 text-sm font-semibold text-[#173737]">ATV #{{ assignment.bike.number }}</span>
        {% endfor %}
      </div>
      {% else %}
      <p class="mt-3 text-sm text-[#3B4F4F]">No bikes marked for this date yet.</p>
      {% endif %}
    </div>
  </div>
</section>

{% endblock content %}
