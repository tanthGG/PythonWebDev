{% extends 'myapp/base.html' %}
{% load static %}

{% block content %}
<script src="https://cdn.tailwindcss.com"></script>

<section class="bg-gradient-to-br from-white via-[#F9F7C9] to-[#D5F0C1]">
  <div class="mx-auto max-w-6xl px-4 py-16 sm:px-6 lg:px-8">
    <div class="grid gap-12 lg:grid-cols-[1.1fr_0.9fr] lg:items-center">
      <div class="space-y-6">
        <span class="inline-flex items-center gap-2 rounded-full bg-[#AAD9BB]/50 px-4 py-1 text-sm font-medium text-[#244b4b]">ATV adventure program</span>
        <h1 class="text-4xl font-black text-[#173737] sm:text-5xl">{{ program.name }}</h1>
        <p class="max-w-2xl text-base leading-7 text-[#3B4F4F]">{{ program.description|default:"Explore Phuket’s lush trails, rubber plantations, and hidden beaches with our certified guides." }}</p>

        <div class="flex flex-wrap gap-3 text-xs uppercase tracking-wide text-[#244b4b]">
          <span class="inline-flex items-center gap-2 rounded-full bg-[#AAD9BB] px-4 py-2 font-semibold">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6l4 2"/></svg>
            {{ program.duration_minutes }} minutes
          </span>
          <span class="inline-flex items-center gap-2 rounded-full bg-[#D5F0C1] px-4 py-2 font-semibold">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m3 7 9-4 9 4-9 4-9-4zm0 6 9 4 9-4"/></svg>
            Recommended 8+
          </span>
        </div>

        <div class="flex flex-wrap items-center gap-3">
          <a href="{% url 'booking-page' %}#packages" class="inline-flex items-center rounded-full bg-[#80BCBD] px-6 py-3 text-sm font-semibold text-white shadow-lg shadow-[#80BCBD]/40 transition hover:bg-[#6AA4A5] focus:outline-none focus:ring-4 focus:ring-[#AAD9BB]">
            Reserve your slot
          </a>
          <a href="{% url 'contact-page' %}" class="inline-flex items-center rounded-full border border-[#AAD9BB] px-6 py-3 text-sm font-semibold text-[#244b4b] transition hover:bg-[#AAD9BB]/40">
            Talk to a guide
          </a>
        </div>

      </div>

      <div class="relative overflow-hidden rounded-[32px] border border-[#AAD9BB] bg-white shadow-xl shadow-[#AAD9BB]/40">
        {% if primary_image %}
        <img src="{{ primary_image.image.url }}" alt="{{ primary_image.alt_text|default:program.name }}" class="h-full w-full object-cover" />
        {% else %}
        <img src="{% static 'image/atv.png' %}" alt="ATV" class="h-full w-full object-cover" />
        {% endif %}
      </div>
    </div>
  </div>
</section>

<main class="bg-white">
  <div class="mx-auto max-w-6xl space-y-16 px-4 py-16 sm:px-6 lg:px-8">
    <section class="rounded-3xl border border-[#AAD9BB] bg-[#F9F7C9]/60 p-8 shadow-lg shadow-[#AAD9BB]/20">
      <div class="grid gap-10 lg:grid-cols-[1fr_1.2fr] lg:items-center">
        <div class="space-y-4">
          <span class="inline-flex items-center gap-2 rounded-full bg-white px-4 py-1 text-xs font-semibold uppercase tracking-wide text-[#35605A]">
            Photo memories
          </span>
          <h2 class="text-3xl font-bold text-[#173737]">See the trail before you ride</h2>
          <p class="text-sm leading-6 text-[#3B4F4F]">
            Swipe through real tour photos captured by our guides. Tap any frame to open it fullscreen and get a closer look at
            the terrain, scenery, and vibe.
          </p>
          <ul class="space-y-2 text-sm text-[#244b4b]">
            <li class="flex items-center gap-2">
              <span class="h-2 w-2 rounded-full bg-[#80BCBD]"></span>
              Variety of jungle, river, and beach trails
            </li>
            <li class="flex items-center gap-2">
              <span class="h-2 w-2 rounded-full bg-[#AAD9BB]"></span>
              Authentically shot during real Phuket ATV runs
            </li>
            <li class="flex items-center gap-2">
              <span class="h-2 w-2 rounded-full bg-[#F9F7C9]"></span>
              New shots added whenever our crew captures fresh angles
            </li>
          </ul>
        </div>
        <div class="relative">
          <div class="relative overflow-hidden rounded-[36px] border border-[#AAD9BB] bg-white shadow-xl shadow-[#AAD9BB]/40">
            <div id="program-gallery" class="relative h-[320px] w-full overflow-hidden rounded-[32px] bg-gray-50 sm:h-[420px]">
              {% for image in program_gallery %}
              <div data-program-slide class="program-slide absolute inset-0 cursor-pointer opacity-0 transition-opacity duration-700 pointer-events-none" data-program-full="{{ image.url }}">
                <img src="{{ image.url }}" alt="{{ image.alt|default:program.name }}" class="h-full w-full object-cover" />
              </div>
              {% endfor %}
            </div>
            {% if program_gallery|length > 1 %}
            <button type="button" aria-label="Previous photo" data-program-prev class="group absolute left-4 top-1/2 z-10 flex -translate-y-1/2 items-center justify-center rounded-full bg-white/80 p-2 shadow hover:bg-white">
              <svg class="h-5 w-5 text-gray-700" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="m15 19-7-7 7-7" />
              </svg>
            </button>
            <button type="button" aria-label="Next photo" data-program-next class="group absolute right-4 top-1/2 z-10 flex -translate-y-1/2 items-center justify-center rounded-full bg-white/80 p-2 shadow hover:bg-white">
              <svg class="h-5 w-5 text-gray-700" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="m9 5 7 7-7 7" />
              </svg>
            </button>
            <div class="absolute bottom-4 left-1/2 z-10 flex -translate-x-1/2 gap-2">
              {% for image in program_gallery %}
              <button type="button" data-program-dot="{{ forloop.counter0 }}" class="h-2.5 w-2.5 rounded-full bg-white/40 transition hover:bg-white focus:outline-none focus:ring-2 focus:ring-white/70"></button>
              {% endfor %}
            </div>
            {% endif %}
          </div>
          <p class="mt-4 text-xs text-[#3B4F4F]">Click any image to expand it. Use the arrows or dots to browse.</p>
        </div>
      </div>
    </section>

    {% if itinerary %}
    <section>
      <div class="grid gap-8 lg:grid-cols-[1fr_1.3fr] lg:items-start">
        <header>
          <h2 class="text-2xl font-bold text-[#173737]">Itinerary highlights</h2>
          <p class="mt-2 text-sm text-[#3B4F4F]">A quick look at each moment of the ride, from gearing up to returning to camp.</p>
        </header>
        <ol class="relative space-y-4 rounded-3xl border border-[#AAD9BB] bg-[#F9F7C9]/60 px-6 py-6 text-sm text-[#244b4b] shadow-lg shadow-[#AAD9BB]/20">
          {% for line in itinerary %}
          <li class="flex gap-4">
            <span class="relative mt-1 flex h-3 w-3 flex-none items-center justify-center">
              <span class="absolute h-full w-0.5 -top-4 bg-[#AAD9BB]" style="{% if forloop.first %}display:none{% endif %}"></span>
              <span class="relative h-3 w-3 rounded-full bg-[#80BCBD]"></span>
            </span>
            <span>{{ line }}</span>
          </li>
          {% endfor %}
        </ol>
      </div>
    </section>
    {% endif %}

    {% if schedule_lines %}
    <section class="rounded-3xl border border-[#AAD9BB] bg-white shadow-xl shadow-[#AAD9BB]/20">
      <header class="border-b border-[#AAD9BB] px-6 py-4">
        <h2 class="text-2xl font-bold text-[#173737]">Tour schedule & transfers</h2>
      </header>
      <div class="overflow-hidden px-6 py-6 text-sm text-[#3B4F4F]">
        <table class="w-full overflow-hidden rounded-2xl border border-[#D5F0C1]">
          <tbody>
            {% with first=schedule_lines|first %}
            <tr class="bg-[#D5F0C1]">
              <th scope="row" class="w-40 px-4 py-3 text-left text-sm font-semibold text-[#173737]">Time slots</th>
              <td class="px-4 py-3 text-[#173737]">{{ first }}</td>
            </tr>
            {% endwith %}
            {% for line in schedule_lines|slice:"1:" %}
            <tr class="border-t border-[#D5F0C1]/70">
              {% if forloop.first %}
              <th scope="row" class="w-40 px-4 py-3 align-top text-left text-sm font-semibold text-[#173737]">Transfer details</th>
              {% else %}
              <th scope="row" class="w-40 px-4 py-3 align-top"></th>
              {% endif %}
              <td class="px-4 py-3">{{ line }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="2" class="px-4 py-3">Contact us to customise your schedule.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </section>
    {% endif %}

    <section class="rounded-3xl border border-[#AAD9BB] bg-white shadow-xl shadow-[#AAD9BB]/20">
      <header class="border-b border-[#AAD9BB] px-6 py-4">
        <h2 class="text-2xl font-bold text-[#173737]">Pricing per person</h2>
        <p class="mt-1 text-sm text-[#3B4F4F]">Choose your riding style. Rates include safety briefing, helmets, gloves, and refreshments.</p>
      </header>
      <div class="overflow-hidden px-6 py-6 text-sm text-[#3B4F4F]">
        <div class="grid gap-6 lg:grid-cols-2">
          {% for row in pricing_table %}
          <div class="rounded-2xl border border-[#D5F0C1] bg-[#F9F7C9]/70 p-6 shadow">
            <h3 class="text-lg font-semibold text-[#173737]">{{ row.label }}</h3>
            <table class="mt-4 w-full text-sm">
              <tbody>
                {% for entry in row.entries %}
                <tr class="border-b border-[#D5F0C1]/70 last:border-0">
                  <td class="py-2 font-medium">{{ entry.label }}</td>
                  <td class="py-2 text-right text-base font-semibold text-[#244b4b]">
                    {% if entry.price %}
                      {{ entry.price|floatformat:0 }} THB
                    {% else %}
                      —
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% endfor %}
        </div>

        {% if pricing_notes %}
        <ul class="mt-6 space-y-2 text-sm">
          {% for line in pricing_notes %}
          <li class="flex gap-3"><span class="mt-1 h-2 w-2 rounded-full bg-[#80BCBD]"></span><span>{{ line }}</span></li>
          {% endfor %}
        </ul>
        {% endif %}
      </div>
    </section>

    <section class="grid gap-6 lg:grid-cols-2">
      <div class="rounded-3xl border border-[#AAD9BB] bg-white p-6 shadow-lg shadow-[#AAD9BB]/20">
        <h2 class="text-xl font-bold text-[#173737]">Tour includes</h2>
        <ul class="mt-4 space-y-2 text-sm">
          {% for line in includes %}
          <li class="flex gap-3 text-[#3B4F4F]"><span class="mt-1 h-2 w-2 rounded-full bg-[#80BCBD]"></span>{{ line }}</li>
          {% empty %}
          <li class="text-[#3B4F4F]">No additional inclusions listed.</li>
          {% endfor %}
        </ul>
      </div>
      <div class="rounded-3xl border border-[#F9F7C9] bg-white p-6 shadow-lg shadow-[#F9F7C9]/30">
        <h2 class="text-xl font-bold text-[#173737]">Tour excludes</h2>
        <ul class="mt-4 space-y-2 text-sm">
          {% for line in excludes %}
          <li class="flex gap-3 text-[#3B4F4F]"><span class="mt-1 h-2 w-2 rounded-full bg-[#F9F7C9] border border-[#D5F0C1]"></span>{{ line }}</li>
          {% empty %}
          <li class="text-[#3B4F4F]">Everything needed for a great ride is included.</li>
          {% endfor %}
        </ul>
      </div>
    </section>

    {% if notes %}
    <section class="rounded-3xl border border-[#AAD9BB] bg-white p-6 shadow-lg shadow-[#AAD9BB]/20">
      <h2 class="text-xl font-bold text-[#173737]">Please note</h2>
      <div class="mt-4 grid gap-4 md:grid-cols-2">
        {% for line in notes %}
        <div class="flex gap-3 rounded-2xl bg-[#F9F7C9]/60 px-4 py-3 text-sm text-[#3B4F4F]">
          <span class="mt-1 h-2 w-2 flex-none rounded-full bg-[#35605A]"></span>
          <span>{{ line }}</span>
        </div>
        {% endfor %}
      </div>
    </section>
    {% endif %}

    <section class="rounded-3xl bg-gradient-to-r from-[#80BCBD] via-[#AAD9BB] to-[#D5F0C1] px-8 py-10 text-[#103232] shadow-xl">
      <div class="grid gap-4 md:grid-cols-[1.3fr_1fr] md:items-center">
        <div class="space-y-2">
          <h2 class="text-2xl font-bold">Ready to experience the jungle?</h2>
          <p class="text-sm">Reserve online or chat with our guides to build a custom package with transfers, flying fox, or rafting add-ons.</p>
        </div>
        <div class="flex flex-wrap gap-3 md:justify-end">
          <a href="{% url 'booking-page' %}#packages" class="inline-flex items-center rounded-full bg-[#103232] px-5 py-2.5 text-sm font-semibold text-white shadow hover:bg-[#0d2a2a]">Book now</a>
          <a href="{% url 'contact-page' %}" class="inline-flex items-center rounded-full border border-[#103232] px-5 py-2.5 text-sm font-semibold text-[#103232] hover:bg-[#103232]/10">Contact us</a>
        </div>
      </div>
    </section>
  </div>
</main>

<div id="program-gallery-modal" class="fixed inset-0 z-50 hidden bg-black/70 px-4 py-8">
  <div class="relative mx-auto flex h-full max-w-5xl items-center justify-center">
    <button type="button" aria-label="Close gallery" data-program-modal-close class="absolute right-0 top-0 rounded-full bg-white/90 p-2 text-gray-800 shadow">
      <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6m0 12L6 6" />
      </svg>
    </button>
    <img data-program-modal-image src="" alt="{{ program.name }} photo" class="max-h-[80vh] w-auto rounded-2xl object-contain shadow-2xl" />
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const programSlides = document.querySelectorAll('[data-program-slide]');
    if (!programSlides.length) {
      return;
    }
    const programDots = document.querySelectorAll('[data-program-dot]');
    const programPrev = document.querySelector('[data-program-prev]');
    const programNext = document.querySelector('[data-program-next]');
    const modal = document.getElementById('program-gallery-modal');
    const modalImage = modal?.querySelector('[data-program-modal-image]');
    const modalClose = modal?.querySelector('[data-program-modal-close]');
    let currentIndex = 0;

    const setActiveDot = (index) => {
      programDots.forEach((dot, idx) => {
        const active = idx === index;
        dot.classList.toggle('bg-white', active);
        dot.classList.toggle('bg-white/40', !active);
      });
    };

    const showSlide = (index) => {
      programSlides.forEach((slide, idx) => {
        const active = idx === index;
        slide.classList.toggle('opacity-100', active);
        slide.classList.toggle('opacity-0', !active);
        slide.classList.toggle('pointer-events-none', !active);
      });
      currentIndex = index;
      setActiveDot(index);
    };

    const nextSlide = () => {
      const nextIndex = (currentIndex + 1) % programSlides.length;
      showSlide(nextIndex);
    };

    const prevSlide = () => {
      const prevIndex = (currentIndex - 1 + programSlides.length) % programSlides.length;
      showSlide(prevIndex);
    };

    programNext?.addEventListener('click', nextSlide);
    programPrev?.addEventListener('click', prevSlide);

    programDots.forEach((dot) => {
      dot.addEventListener('click', () => {
        const index = Number(dot.dataset.programDot);
        showSlide(index);
      });
    });

    const openModal = (url) => {
      if (!modal || !modalImage || !url) return;
      modalImage.src = url;
      modal.classList.remove('hidden');
      document.body.classList.add('overflow-hidden');
    };

    const closeModal = () => {
      if (!modal) return;
      modal.classList.add('hidden');
      document.body.classList.remove('overflow-hidden');
    };

    programSlides.forEach((slide) => {
      slide.addEventListener('click', () => openModal(slide.dataset.programFull));
    });

    modalClose?.addEventListener('click', closeModal);
    modal?.addEventListener('click', (event) => {
      if (event.target === modal) {
        closeModal();
      }
    });

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape' && !modal?.classList.contains('hidden')) {
        closeModal();
      }
    });

    showSlide(0);
  });
</script>

{% endblock content %}
