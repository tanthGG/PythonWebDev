{% extends 'myapp/base.html' %}

{% block myheader %}
<h1> Add Product </h1>
{% endblock myheader %}

{% block content %}
  {% if success %}
    <div class="modal fade" id="productSuccessModal" tabindex="-1" aria-labelledby="productSuccessLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header bg-success text-white">
            <h1 class="modal-title fs-5" id="productSuccessLabel">Product added</h1>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p class="mb-0">The product was saved successfully.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-success" data-bs-dismiss="modal">Great!</button>
          </div>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        var form = document.getElementById('add-product-form');
        if (form) {
          form.reset();
        }

        var modalElement = document.getElementById('productSuccessModal');
        if (!modalElement) {
          return;
        }

        if (window.bootstrap && window.bootstrap.Modal) {
          var modal = window.bootstrap.Modal.getOrCreateInstance(modalElement);
          modal.show();
          return;
        }

        modalElement.classList.add('show');
        modalElement.style.display = 'block';
        modalElement.removeAttribute('aria-hidden');
        modalElement.setAttribute('aria-modal', 'true');

        var backdrop = document.createElement('div');
        backdrop.className = 'modal-backdrop fade show';
        document.body.appendChild(backdrop);

        var closeModal = function () {
          modalElement.classList.remove('show');
          modalElement.style.display = 'none';
          modalElement.setAttribute('aria-hidden', 'true');
          modalElement.removeAttribute('aria-modal');
          if (backdrop && backdrop.parentNode) {
            backdrop.parentNode.removeChild(backdrop);
          }
        };

        var closeButtons = modalElement.querySelectorAll('[data-bs-dismiss="modal"]');
        closeButtons.forEach(function (btn) {
          btn.addEventListener('click', closeModal);
        });

        modalElement.addEventListener('click', function (event) {
          if (event.target === modalElement) {
            closeModal();
          }
        });
      });
    </script>
  {% endif %}

  {% if message %}
    <h3>{{ message }}</h3>
  {% else %}
    <form id="add-product-form" method="POST" enctype="multipart/form-data">
      {% csrf_token %} <!-- Cross-site request forgery -->
      
      <div class="form-group">
        <label for="title">Title:</label>
        <input type="text" class="form-control" id="title" name="title" required>
      </div>

      <div class="form-group">
        <label for="description">Description:</label>
        <textarea class="form-control" rows="5" id="description" name="description" required></textarea>
      </div>

      <div class="form-group">
        <label for="price">Price:</label>
        <input type="text" class="form-control" id="price" name="price" required>
      </div>

      <div class="form-group">
        <label for="quantity">Quantity:</label>
        <input type="text" class="form-control" id="quantity" name="quantity" value="0" required>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="checkbox" value="yes" id="instock" name="instock">
        <label class="form-check-label" for="instock">Instock?</label>
      </div>

      <div class="mb-3">
        <label for="picture" class="form-label">Picture:</label>
        <input class="form-control" type="file" id="picture" name="picture">
      </div>

      <div class="mb-3">
        <label for="specfile" class="form-label">Specfile:</label>
        <input class="form-control" type="file" id="specfile" name="specfile">
      </div>

      <button type="submit" class="btn btn-primary">Add Product</button>
    </form>
  {% endif %}
{% endblock content %}
